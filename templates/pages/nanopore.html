{% extends "base.html" %}

{% block title %}Nanopore Sequencing Data Analysis{% endblock %}

{% block content %}
    <!-- Модальное окно для незарегистрированных пользователей -->
    {% if not user_authenticated %}
    <div id="registrationModal" class="modal" style="display: block;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Registration Required</h3>
            <p>You need to register or log in to submit data for analysis.</p>
            <div class="modal-actions">
                <a href="/auth/register" class="button button--primary">Register</a>
                <a href="/auth/login" class="button button--secondary">Log In</a>
            </div>
        </div>
    </div>
    {% endif %}

    <form class="form" id="nanoporeForm" enctype="multipart/form-data">

        {% if user_authenticated %}
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        {% endif %}

        <h1 class="page__title">Nanopore Sequencing Data</h1>
        
        {% include "includes/form_disclaimer.html" %}

        <div class="form__group">
            <label class="form__label">fastq file archive:</label>
            <div class="flex flex--row flex--align-center gap--sm">
                <input type="file" id="fastqFile" class="form__control" accept=".fastq,.gz" required>
                <button type="button" class="button button--secondary" onclick="document.getElementById('fastqFile').click()">Browse...</button>
            </div>
        </div>

        <!-- Nanopore-specific parameters -->
        <div class="form__group">
            <label class="form__label">Read trimming:</label>
            <div class="flex flex--row flex--wrap gap--md mb--md">
                <div class="form__group">
                    <label class="form__label" for="trim_first_bases">trim_first_bases:</label>
                    <input type="number" id="trim_first_bases" class="form__control" min="0" value="80">
                    <p class="text--sm text--muted">Bases to trim from start (50-200 typical)</p>
                </div>
                <div class="form__group">
                    <label class="form__label" for="trim_after_base">trim_after_base:</label>
                    <input type="number" id="trim_after_base" class="form__control" min="0" value="700">
                    <p class="text--sm text--muted">Trim all bases beyond this position</p>
                </div>
            </div>
        </div>

        <!-- Classification parameters -->
        <div class="form__group">
            <label class="form__label">Reference sequences:</label>
            <select class="form__control" id="ref_seq">
                <option value="silva">SILVA (16S/18S)</option>
                <option value="midori">MIDORI (COI)</option>
                <option value="unite">UNITE (ITS)</option>
                <option value="custom">Custom Sequence</option>
            </select>
            <p class="text--sm text--muted">Must match your marker gene</p>
        </div>

        <div class="form__group">
            <label class="form__label">Reference database:</label>
            <select class="form__control" id="ref_db">
                <option value="gtdb">GTDB</option>
                <option value="ncbi">NCBI</option>
                <option value="custom">Custom Database</option>
            </select>
            <p class="text--sm text--muted">Must match your reference sequences</p>
        </div>

        {% include "includes/form_common.html" %}

        <div class="form__actions">
            {% if user_authenticated %}
                <button type="submit" class="button button--primary">Submit</button>
            {% else %}
                <button type="button" class="button button--disabled" disabled>Submit</button>
                <span class="registration-hint">Registration required to submit form</span>
            {% endif %}
        </div>
    </form>
{% endblock %}